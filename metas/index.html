
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Metas • Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    :root{--bg:#0a0a0a;--panel:#111;--soft:#161616;--ink:#f5f7ff;--muted:#a9b0c2;--primary:#00d1ff;--accent:#ff2e88;--ok:#37d399;--warn:#fec84b;--danger:#f43f5e;--shadow:0 10px 40px rgba(0,0,0,.45);--r:18px}
    *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;color:var(--ink);background:
      radial-gradient(1100px 720px at 65% -10%, rgba(0,209,255,.12), transparent 60%),
      radial-gradient(900px 540px at -10% 15%, rgba(255,46,136,.10), transparent 55%),var(--bg)}
    .wrap{max-width:1200px;margin:24px auto;padding:0 18px}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
    .title{font-size:24px;font-weight:800}
    .sub{color:var(--muted)}
    .controls{display:flex;gap:10px}
    select,input,button{background:var(--panel);border:1px solid #1f1f1f;color:var(--ink);padding:10px 12px;border-radius:12px}
    main{display:grid;gap:16px;grid-template-columns:2fr 1fr}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.02)),var(--panel);border:1px solid #1e1e1e;border-radius:var(--r);padding:16px;box-shadow:var(--shadow)}
    .kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-top:12px}
    .k{background:#0f0f0f;border:1px solid #1f1f1f;border-radius:14px;padding:12px}
    .k .l{color:var(--muted);font-size:12px}.k .v{font-size:22px;font-weight:800;margin-top:4px}
    .tbl{width:100%;border-collapse:collapse;font-size:14px}
    .tbl th,.tbl td{padding:10px;border-bottom:1px solid #1f1f1f;color:#dbe1f1}
    .tbl th{color:var(--muted);font-weight:600;text-align:left}
    .back{display:inline-block;margin-top:10px;text-decoration:none;background:var(--primary);color:#0a0a0a;padding:10px 14px;border-radius:10px;font-weight:700}
    @media(max-width:980px){main{grid-template-columns:1fr}.kpis{grid-template-columns:repeat(2,1fr)}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <div class="title">Metas</div>
        <div class="sub">Faturamento vs. objetivo</div>
      </div>
      <div class="controls">
        <select id="empresa">
          <option value="TODAS">Todas as empresas</option>
          <option>MERCATTO DELICIA</option><option>DELICIA GOURMET</option>
          <option>PADARIA DELICIA</option><option>VILLA GOURMET</option><option>M. KIDS</option>
        </select>
        <input type="month" id="periodo" />
        <button id="btn">Atualizar</button>
      </div>
    </header>

    <main>
      <section class="card">
        <h3 style="margin:0 0 8px;color:var(--muted)">Série temporal</h3>
        <canvas id="line" height="270"></canvas>
        <div class="kpis">
          <div class="k"><div class="l">Progresso</div><div id="k1" class="v">—</div></div>
          <div class="k"><div class="l">Meta</div><div id="k2" class="v">—</div></div>
          <div class="k"><div class="l">Realizado</div><div id="k3" class="v">—</div></div>
          <div class="k"><div class="l">Δ mês/mês</div><div id="k4" class="v">—</div></div>
        </div>
      </section>
      <aside class="card">
        <h3 style="margin:0 0 8px;color:var(--muted)">Distribuição por unidade</h3>
        <canvas id="bar" height="270"></canvas>
      </aside>
    </main>

    <section class="card" style="margin-top:16px">
      <h3 style="margin:0 0 8px;color:var(--muted)">Resumo do mês</h3>
      <table class="tbl" id="table">
        <thead><tr><th>Dia</th><th>Realizado</th><th>Meta diária</th><th>%</th></tr></thead>
        <tbody></tbody>
      </table>
      <a href="../index.html" class="back">⟵ Voltar ao Painel</a>
    </section>
  </div>

<script>
const APIS={ METAS:'https://script.google.com/macros/s/AKfycbziCPWWJxxfrnSeT3RHsNbw21z9MfnnB8JpV7ZQcZnvUQQ7dL3lVJdpUG7epACVjFaO/exec' };
const $=s=>document.querySelector(s); const fmtBR=n=>n.toLocaleString('pt-BR');
function qp(k){return new URLSearchParams(location.search).get(k)||''}
function setFromQuery(){ const e=qp('empresa')||'TODAS';const p=qp('periodo')||new Date().toISOString().slice(0,7);$('#empresa').value=e;$('#periodo').value=p }
function build(url){const u=new URL(url);u.searchParams.set('empresa',$('#empresa').value);u.searchParams.set('periodo',$('#periodo').value);return u}
function makeLine(ctx){return new Chart(ctx,{type:'line',data:{labels:[],datasets:[{label:'Realizado',data:[],tension:.35,borderWidth:2,pointRadius:0,borderColor:'#00d1ff'},{label:'Meta diária',data:[],tension:.35,borderWidth:2,pointRadius:0,borderColor:'#ff2e88'}]},options:{plugins:{legend:{labels:{color:'#9aa3b8'}}},scales:{x:{ticks:{color:'#8b93a7'}},y:{grid:{color:'rgba(255,255,255,.06)'}}}})});}
function makeBar(ctx){return new Chart(ctx,{type:'bar',data:{labels:[],datasets:[{label:'% meta',data:[],backgroundColor:'#00d1ff'}]},options:{plugins:{legend:{labels:{color:'#9aa3b8'}}},scales:{y:{grid:{color:'rgba(255,255,255,.06)'}}}})});}
let L,B;async function load(){
  const url=build(APIS.METAS);
  let d; try{ d=await (await fetch(url)).json(); }catch(e){ d=null }
  const meta=d?.meta||0, real=d?.realizado||0, serie=d?.serie||Array.from({length:12},(_,i)=>Math.round(1000+Math.random()*5000));
  const mdia=(meta>0?meta/30:0); const serieMeta=serie.map(_=>mdia);
  if(!L){L=makeLine($('#line'));} if(!B){B=makeBar($('#bar'));}
  L.data.labels=serie.map((_,i)=>String(i+1).padStart(2,'0')); L.data.datasets[0].data=serie; L.data.datasets[1].data=serieMeta; L.update();
  B.data.labels=['Mercatto','Delícia G.','Padaria','Villa','M. Kids']; B.data.datasets[0].data=[80,95,60,92,70]; B.update();
  $('#k1').textContent= meta? Math.round((real/meta)*100)+'%':'—';
  $('#k2').textContent='R$ '+fmtBR(meta||0);
  $('#k3').textContent='R$ '+fmtBR(real||0);
  $('#k4').textContent=d?.deltaMM??'—';
  const tb=$('#table tbody'); tb.innerHTML='';
  serie.forEach((v,i)=>{ const tr=document.createElement('tr'); const pct=mdia? Math.round((v/mdia)*100):0; tr.innerHTML=`<td>${String(i+1).padStart(2,'0')}</td><td>R$ ${fmtBR(v)}</td><td>R$ ${fmtBR(Math.round(mdia))}</td><td>${pct}%</td>`; tb.appendChild(tr) });
}
window.addEventListener('DOMContentLoaded',()=>{setFromQuery(); load(); $('#btn').onclick=load; $('#empresa').onchange=load; $('#periodo').onchange=load});
</script>
</body>
</html>
